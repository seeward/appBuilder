<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>$(document).ready(function() {


    // options obj
    var options = {
        debug: true,
        GitHub: true,
        kalmeerMode: true

    };

    //loader image
    var loader = "&lt;img src='loader.gif' />";

    // var fro Github API object
    var gh = {};
    // current user - if logged in
    var currentUser = {};

    // setup ACE editors and declare options
    var jseditor = ace.edit("jsEditor");
    jseditor.setOption("showPrintMargin", false);
    jseditor.setOption("fontSize", "24px");
    jseditor.setTheme("ace/theme/monokai");
    jseditor.$blockScrolling = Infinity;
    jseditor.getSession().setMode("ace/mode/javascript");

    var htmleditor = ace.edit("htmlEditor");
    htmleditor.setOption("showPrintMargin", false);
    htmleditor.setOption("fontSize", "24px");
    htmleditor.setTheme("ace/theme/chrome");
    htmleditor.$blockScrolling = Infinity;
    htmleditor.getSession().setMode("ace/mode/html");

    var csseditor = ace.edit("cssEditor");
    csseditor.setOption("showPrintMargin", false);
    csseditor.$blockScrolling = Infinity;
    csseditor.setOption("fontSize", "24px");
    csseditor.setTheme("ace/theme/eclipse");
    csseditor.getSession().setMode("ace/mode/css");


    // Gather textareas
    var html_editor = $("#htmlBody"),
        css_editor = $("#cssBody"),
        js_editor = $("#jsBody");

    // Store textarea references to array
    var editors = [html_editor, css_editor, js_editor];


    // pointer to current note and temp files for note processing
    var currentNote = "";
    var tempFile = "";
    var newHold = "";

    // Functions


    /**
     * create file to export to GIST
     * @method createGist
     * @param {} fileName
     * @param {} dataToWrite
     */
    var createGist = function(fileName, dataToWrite) {
        var file = {};
        var key = fileName;
        file[key] = {
            content: dataToWrite
        };
        $("#msgBox").fadeIn().html(loader + " Writing file to GitHub...");
        console.log("Writing file to GitHub...");
        files = {
            "exportFromAppBuilder.txt": {
                content: dataToWrite
            }
        };
        gh.getGist().create(file)
            .done(function(gist) {
                //console.log(JSON.stringify(gist));
                $("#msgBox").html("&lt;span class='glyphicon glyphicon-ok'>&lt;/span> GIST saved successfully");
                $("#msgBox").show();
                setTimeout(function() {
                    $("#msgBox").fadeOut();
                }, 2000);
            });
    };


    /**
     * build up object to export
     * @method exportToGitHub
     */
    var exportToGitHub = function() {
        var holder = [];
        keys = Object.keys(localStorage);
        //console.log(keys);
        $.each(keys, function(i, obj) {
            //console.log(JSON.stringify(obj));
            if (obj != "cache") {
                //console.log(obj);
                eachProject = JSON.parse(window.localStorage.getItem(obj));
                if (eachProject.html) {
                    holder.push(eachProject);
                }
            }
        });
        tempFile = JSON.stringify(holder);
        createGist("fullProjectsBackup.json", tempFile);

    };


    /**
     * func to store cache of unsaved projects
     * @method cacheLog
     */
    var cacheLog = function() {
        cache = {};
        jsCache = jseditor.getValue();
        htmlCache = htmleditor.getValue();
        cssCache = csseditor.getValue();
        extJS = $("#libjs").val();
        extCSS = $("#libcss").val();
        cache.html = htmlCache;
        cache.js = jsCache;
        cache.css = cssCache;
        cache.extJS = extJS;
        cache.extCSS = extCSS;

        window.localStorage.setItem("cache", JSON.stringify(cache));

    };

    /**
     * Retore unsaved project to editors on restart init()
     * @method restoreFromCache
     */
    function restoreFromCache() {
        if (window.localStorage.getItem("cache")) {
            restoreCache = JSON.parse(window.localStorage.getItem("cache"));
            htmleditor.setValue(restoreCache.html);
            jseditor.setValue(restoreCache.js);
            csseditor.setValue(restoreCache.css);

            $("#libjs").val(restoreCache.extJS);
            $("#libcss").val(restoreCache.extCSS);
        }
    };


    /**
     * Unique ID generator fro Projects
     * @method makeId text
     * @return string text
     */
    var makeId = function() {
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        for (var i = 0; i &lt; 5; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));
        console.log(text);
        return text;
    }


    /**
     * save cache to project
     * @method saveProject
     */
    var saveProject = function() {
        render();
        if (!window.localStorage.getItem(currentNote)) {
            us = JSON.parse(window.localStorage.getItem("u"));
            saver = JSON.parse(window.localStorage.getItem("cache"));
            saver.title = prompt("Name project:");
            saver.author = us.user;
            saver.createdDate = new Date();
            saver.id = makeId();
            console.log(saver.id);
            saver.type = "Web App";

            currentNote = saver.title;
            $(".current").html(currentNote);
            if (saver.title != null) {
                window.localStorage.setItem(saver.title, JSON.stringify(saver));
                $("#msgBox").html("&lt;span class='glyphicon glyphicon-ok'>Project saved!&lt;/span>").fadeIn();
            }
        } else {
            saver = JSON.parse(window.localStorage.getItem("cache"));
            //saver.id = makeId();
            //console.log(saver.id);
            window.localStorage.setItem(currentNote, JSON.stringify(saver));
            $("#msgBox").html("&lt;span class='glyphicon glyphicon-ok'>Project saved!&lt;/span>").fadeIn();

        }

        getSaved();
    };


    /**
     * restore all saved projects from LocalStorage
     * @method getSaved
     */
    var getSaved = function() {
        var x = 0;
        $("#consoleLog").html("");
        keys = Object.keys(localStorage);
        //console.log(keys);
        var rows = keys.length;
        $.each(keys, function(i, obj) {
            if (x &lt;= 100) {
                x = x + 10;
            }

            if (obj != "u") {
                if (obj != "cache") {
                    // console.log(obj);
                    $("#consoleLog").append("&lt;tr>&lt;td>&lt;a style='margin-top:7px;width:150px' class='noteRow btn btn-block btn-default righter' id='" + obj + "'>" + obj + "&lt;/a>&lt;/td>&lt;/tr>");
                };
            }
        });
    };


    /**
     * render iFrame to full screen modal
     * @method renderFull
     */
    var renderFull = function() {
        $("#full").show();

        var source2 = prepareSource();
        //console.log(source);
        // Get reference to output iFrame
        var iframe2 = document.querySelector('#fullest'),
            // Setup iFrame structure
            iframe_doc2 = iframe2.contentDocument;
        // Write to iFrame
        console.log("&lt;---------- Rendering Output Successful ----------->");
        iframe_doc2.open();
        iframe_doc2.write(source2);
        iframe_doc2.close();

    };


    /**
     * Main render into iFrame
     * @method render
     */
    var render = function() {
        // Get src


        var source = prepareSource();
        //console.log(source);
        // Get reference to output iFrame
        var iframe = document.querySelector('#output iframe'),
            // Setup iFrame structure
            iframe_doc = iframe.contentDocument;
        // Write to iFrame
        console.log("&lt;---------- Rendering Output Successful ----------->");
        iframe_doc.open();
        iframe_doc.write(source);
        iframe_doc.close();

        cacheLog();

    };


    /**
     * prepare source doc by inserting values from editors
     * @method prepareSource src
     * @return src
     */
    var prepareSource = function() {
        // Gather textarea values
        var html = htmleditor.getValue(),
            css = csseditor.getValue(),
            js = jseditor.getValue(),
            //lib = $("#libcss").val();
            // libjs = $("#libjs").val();
            src = '';

        // Insert values into src template

        // HTML
        src = base_tpl.replace('&lt;/body>', html + '&lt;/body>');

        // CSS
        css = '&lt;style>' + css + '&lt;/style>';
        src = src.replace('&lt;/head>', css + '&lt;/head>');
        // Libs css
        //libs = '&lt;link href="' + lib + '" rel="stylesheet">&lt;/link>';
        //src = src.replace('&lt;/head>', libs + '&lt;/head>');

        // libs js
        //libsJS = '&lt;script src="' + libjs + '" type="text/javascript">&lt;/script>';
        //src = src.replace('&lt;/head>', libsJS + '&lt;/head>');
        // Javascript
        js = '&lt;script>' + js + '&lt;/script>';
        src = src.replace('&lt;/body>', js + '&lt;/body>');

        // return prepared src with textarea values inserted
        return src;
    };

    /**
     * helper function to import JSON backups
     * @method importer
     */
    var importer = function() {
        $.getJSON("backup.json", function(data) {
            $.each(data, function(i, o) {

                window.localStorage.setItem(o.name, JSON.stringify(o));
            });

        });
    };

    /**
     * helper function to add properties to currentProject obj
     * @method addType
     */
    var addType = function() {

        keys = Object.keys(localStorage);
        //console.log(keys);
        $.each(keys, function(i, obj) {

            fullObj = JSON.parse(window.localStorage.getItem(obj));
            fullObj.type = "Web App";
            fullObj.name = obj.toString();

            cu = window.localStorage.getItem("u");
            cu = JSON.parse(cu);
            fullObj.author = cu.user;
            fullObj.createdDate = new Date();
            window.localStorage.setItem(obj.toString(), JSON.stringify(fullObj));
        });

    };






    // Event Listeners

    $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
        var target = $(e.target).attr("href");
        switch (target) {

            case "#js":
                jseditor.focus();
                jseditor.gotoLine(1);
                console.log("jseditor");
                return
            case "#css":
                csseditor.focus();
                csseditor.gotoLine(1);
                console.log("csseditor");
            case "#html":
                htmleditor.focus();
                htmleditor.gotoLine(1);
                console.log("htmleditor");
        }
    });




    $("#logout").click(function(e) {
        e.preventDefault();
        window.localStorage.removeItem("u");
        $("#msgBox").show().html("User Logged Out!");
        setTimeout(function() {
            $("#msgBox").hide();
        }, 3000);
    });


    $("#mobiInsert").click(function(e) {
        e.preventDefault();
        htmleditor.setValue(mobileHTML);
        jseditor.setValue(jsTest);


    });



    $("#consoleLog").searcher({
        inputSelector: "#searchTerm"
        // itemSelector (tbody > tr) and textSelector (td) already have proper default values
    });



    $("#exportToGitHub").click(function(e) {
        e.preventDefault();
        exportToGitHub();
    });


    $("#export").click(function(e) {
        e.preventDefault();

        if (jseditor.getValue() != "" &amp;&amp; csseditor.getValue() != "" &amp;&amp; htmleditor.getValue() != "") {

            toFile = prepareSource();
            window.location = "data:application/octet-stream," + escape(toFile);
            createGist(currentNote, toFile);
            //console.log(currentNote);

        } else {
            $("#msgBox").html("&lt;span class='glyphicon glyphicon-ban-circle fonter'>You cannot export an empty project.&lt;/span>").fadeIn();

            setTimeout(function() {
                $("#msgBox").fadeOut();
            }, 3000);
        }
    });


    $("#desktop").click(function() {
        $("#output").css("width", "100%");
        render();
    });

    $("#tablet").click(function() {
        $("#output").css("width", "1024px");
        render();
    });

    $("#mobile").click(function() {
        $("#output").css("width", "400px");
        render();
    });



    $("#inserter").click(function(e) {
        e.preventDefault();
        jseditor.setValue("");
        csseditor.setValue("");
        htmleditor.setValue(polyTemp);

    });


    // clear all 
    $("#clear").click(function() {
        jseditor.setValue("");
        csseditor.setValue("");
        htmleditor.setValue("");

        currentNote = "Empty Project";
        $(".current").html(currentNote);
        render();
    });




    // render iFrame
    $("#go").click(function() {
        render();
    });
    // save project
    $("#saver").click(function() {
        saveProject();
    });

    $("#consoleLog").on("click", "a", function(e) {
        note = $(this).text();
        $("#currentInfo").html("");
        newNote = JSON.parse(window.localStorage.getItem(note));

        js = newNote.js;
        css = newNote.css;
        html = newNote.html;

        currentNote = note;
        $(".current").html(currentNote);
        //$("#currentInfo").append("&lt;tr>&lt;td>Type: &lt;/td>&lt;td>" + newNote.type + "&lt;/td>&lt;/tr>");
        //$("#currentInfo").append("&lt;tr>&lt;td>Author: &lt;/td>&lt;td>" + newNote.author + "&lt;/td>&lt;/tr>");
        // $("#currentInfo").append("&lt;tr>&lt;td>Date&lt;/td>&lt;td>" + newNote.createdDate.substring(0, 10) + "&lt;/td>&lt;/tr>");
        jseditor.setValue(js);
        csseditor.setValue(css);
        htmleditor.setValue(html);

        render();

    });

    $("#deleter").click(function() {
        jseditor.setValue("");
        csseditor.setValue("");
        htmleditor.setValue("");


        if (currentNote != "cache") {
            window.localStorage.removeItem(currentNote);
        }
        currentNote = "...";
        $(".current").html(currentNote);
        getSaved();
    });




    $('.modal-footer button').click(function() {
        var button = $(this);

        if (button.attr("data-dismiss") != "modal") {
            var inputs = $('form input');
            var title = $('.modal-title');
            var progress = $('.progress');
            var progressBar = $('.progress-bar');
            var user = $("#uLogin").val();
            var pass = $("#uPassword").val();
            var userObj = {};

            userObj.user = user;
            userObj.pass = pass;


            window.localStorage.setItem("u", JSON.stringify(userObj));
            currentUser = user;
            inputs.attr("disabled", "disabled");

            button.hide();

            progress.show();

            progressBar.animate({
                width: "100%"
            }, 100);

            progress.delay(1000)
                .fadeOut(600);

            button.text("Close")
                .removeClass("btn-primary")
                .addClass("btn-success")
                .blur()
                .delay(1600)
                .fadeIn(function() {
                    title.text("Log in is successful");
                    button.attr("data-dismiss", "modal");
                });
        }
    });

    $('#myModal').on('hidden.bs.modal', function(e) {
        e.preventDefault();
        var inputs = $('form input');
        var title = $('.modal-title');
        var progressBar = $('.progress-bar');
        var button = $('.modal-footer button');

        inputs.removeAttr("disabled");

        title.text("Log in");

        progressBar.css({
            "width": "0%"
        });

        button.removeClass("btn-success")
            .addClass("btn-primary")
            .text("Ok")
            .removeAttr("data-dismiss");

    });


    $("#fullScreen").click(function() {

        renderFull();

    });

    $("#kalmeer").click(function(e) {
        e.preventDefault();

        if (kalmeerMode == true) {
            $("#jsBody").css("background-color", "black");
            $("#jsBody").css("color", "white");
            $("#htmlBody").css("background-color", "black");
            $("#htmlBody").css("color", "white");
            $("#cssBody").css("background-color", "black");
            $("#cssBody").css("color", "white");
            $("body").css("background-color", "black");
            $("#output").css("background-color", "white");
            kalmeerMode = false;
        } else {
            $("#htmlBody").css("background-color", "white");
            $("#htmlBody").css("color", "black");
            $("#cssBody").css("background-color", "white");
            $("#cssBody").css("color", "black");
            $("#jsBody").css("background-color", "white");
            $("#jsBody").css("color", "black");
            $("body").css("background-color", "white");
            kalmeerMode = true;
        }

    });


    /**
     * global init() function
     * @method init
     * @param {} options
     */
    function init(options) {

        kalmeerMode = options.kalmeerMode;

        if (options.debug == true) {
            console.log("DEBUG MODE");
        }
        //addType();
        //window.localStorage.clear();
        //window.localStorage.removeItem("Parse/COrDTZjsSjOUkiIDHUXiEVdgWfqlURUbm3wKPGJW/installationId");
        $("#msgBox").hide();
        //importer();
        if (window.localStorage.getItem("u")) {
            currentUserCache = JSON.parse(window.localStorage.getItem("u"));
            currentUser = currentUserCache.user;

            gh = new Octokit({
                username: currentUserCache.user,
                password: currentUserCache.pass
            });
        }
        initLog = "\n&lt;------------- init successful ------------->";
        restoreFromCache();
        getSaved();






    };

    init(options);



});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addType">addType</a></li><li><a href="global.html#cacheLog">cacheLog</a></li><li><a href="global.html#createGist">createGist</a></li><li><a href="global.html#exportToGitHub">exportToGitHub</a></li><li><a href="global.html#getSaved">getSaved</a></li><li><a href="global.html#importer">importer</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#makeIdtext">makeId text</a></li><li><a href="global.html#prepareSourcesrc">prepareSource src</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderFull">renderFull</a></li><li><a href="global.html#restoreFromCache">restoreFromCache</a></li><li><a href="global.html#saveProject">saveProject</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha13</a> on Tue Dec 30 2014 12:51:43 GMT+0200 (South Africa Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
